<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Transform Counts — transformCounts • mia</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Transform Counts — transformCounts"><meta property="og:description" content="Variety of transformations for abundance data, stored in assay.
See details for options."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/mia.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/microbiome/mia/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Transform Counts</h1>
    <small class="dont-index">Source: <a href="https://github.com/microbiome/mia/blob/HEAD/R/transformCounts.R" class="external-link"><code>R/transformCounts.R</code></a></small>
    <div class="hidden name"><code>transformCounts.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Variety of transformations for abundance data, stored in <code>assay</code>.
See details for options.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">transformSamples</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clr"</span>, <span class="st">"rclr"</span>, <span class="st">"hellinger"</span>, <span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"rank"</span>, <span class="st">"relabundance"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment</span>
<span class="fu">transformSamples</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clr"</span>, <span class="st">"rclr"</span>, <span class="st">"hellinger"</span>, <span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"rank"</span>, <span class="st">"relabundance"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="fu">transformCounts</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clr"</span>, <span class="st">"rclr"</span>, <span class="st">"hellinger"</span>, <span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"rank"</span>, <span class="st">"relabundance"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment</span>
<span class="fu">transformCounts</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clr"</span>, <span class="st">"rclr"</span>, <span class="st">"hellinger"</span>, <span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"rank"</span>, <span class="st">"relabundance"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="fu">transformFeatures</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"z"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment</span>
<span class="fu">transformFeatures</span><span class="op">(</span>
  <span class="va">x</span>,
  assay_name <span class="op">=</span> <span class="va">abund_values</span>,
  abund_values <span class="op">=</span> <span class="st">"counts"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log10"</span>, <span class="st">"pa"</span>, <span class="st">"z"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="va">method</span>,
  pseudocount <span class="op">=</span> <span class="cn">NULL</span>,
  threshold <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="fu">ZTransform</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment</span>
<span class="fu">ZTransform</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">relAbundanceCounts</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment</span>
<span class="fu">relAbundanceCounts</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A
<code><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></code>
object.</p></dd>


<dt>assay_name</dt>
<dd><p>A single character value for selecting the
<code><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></code> to be
transformed.</p></dd>


<dt>abund_values</dt>
<dd><p>a single <code>character</code> value for specifying which
assay to use for calculation.
(Please use <code>assay_name</code> instead. At some point <code>abund_values</code>
will be disabled.)</p></dd>


<dt>method</dt>
<dd><p>A single character value for selecting the transformation
method.</p></dd>


<dt>name</dt>
<dd><p>A single character value specifying the name of transformed
abundance table.</p></dd>


<dt>pseudocount</dt>
<dd><p>NULL or numeric value deciding whether pseudocount is
added. The numeric value specifies the value of pseudocount.</p></dd>


<dt>threshold</dt>
<dd><p>A numeric value for setting threshold for pa transformation.
By default it is 0. (Only used for <code>method = "pa"</code>)</p></dd>


<dt>...</dt>
<dd><p>additional arguments</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>transformCounts</code>, <code>transformSamples</code>, <code>transformFeatures</code>,
<code>relAbundanceCounts</code>, and <code>ZTransform</code> return <code>x</code> with additional,
transformed abundance table named <code>name</code> in the <code>assay</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>These functions provide a variety of options for transforming abundance data.
The transformed data is calculated and stored in a new <code>assay</code>.</p>
<p>Available wrapper functions include:</p>
<ul><li><p><code>transformSamples</code> sample-wise (column-wise) transformation.
Alias for <code>transformCounts</code>.</p></li>
<li><p><code>transformFeatures</code> feature-wise (row-wise) transformation.</p></li>
<li><p><code>ZTransform</code> Shortcut for Z-transformation.</p></li>
<li><p><code>relAbundanceCounts</code> Shortcut for fetching relative abundance table.</p></li>
</ul><p>Altogether, <code>transformCounts</code> or <code>transformSamples</code> and <code>transformFeatures</code>
apply transformations to the abundance table (assay). The available transformation methods include:</p>
<ul><li><p>'clr' Centered log ratio (clr) transformation aims to remove
compositionality effect; it is also used to
skewness and to center data.If the data contains zeros, pseudocount (commonly the smallest
positive value of the data) must be added since clr is a logarithmic
transformation that only allows positive values.
(See e.g. Gloor et al. 2017.)$$clr = log_{10}\frac{x{g(x)}} = log_{10}x - log_{10}\mu$$
where \(x\) is a single value, g(x) is geometric mean of
sample-wise values, and \(\mu\) is an arithmetic mean of
sample-wise values.</p></li>
<li><p>'rclr' rclr or robust clr is similar to regular clr. Problem of regular
clr is that logarithmic transformations lead to undefined values when zeros
are present in the data. In rclr, values are divided by geometric mean
of observed taxa and zero values are not taken into account. Zero values will
stay as zeroes. Because of high-dimensionality of data, rclr's geometric mean of
observed taxa is a good approximation to the true geometric mean.
(For details, see Martino et al. 2019.).</p></li>
<li><p>'hellinger' Hellinger transformation can be used to reduce the impact of
extreme data points. It can be utilize for clustering or ordination analysis.
(See e.g. Legendre &amp; Gallagher 2001.)$$hellinger = \sqrt{\frac{x}{x_{tot}}}$$
where \(x\) is a single value and \(x_{tot}\) is the sum of
all values</p></li>
<li><p>'log10' log10 transformation can be used for reducing the skewness of the data.$$log10 = \log_{10} x$$
where \(x\) is a single value of data.</p></li>
<li><p>'pa' Transforms table to presence/absence table. All abundances higher
than \(\epsilon\) are transformed to 1 (present), otherwise 0 (absent).
By default, threshold is 0.</p></li>
<li><p>'rank' Rank returns ranks of taxa. For each sample, the least abundant
taxa get lower value and more abundant taxa bigger value. The implementation is
based on the colRanks function with ties.method="first".</p></li>
<li><p>'relabundance' Transforms abundances to relative. Generally, all microbiome
data are compositional. That is, e.g., because all measuring instruments have their capacity limits.
To make results comparable with other results, values must be relative. (See e.g. Gloor et al. 2017.)$$relabundance = \frac{x}{x_{tot}}$$
where \(x\) is a single value and \(x_{tot}\) is the sum of
all values.</p></li>
<li><p>'z' Z-transformation, Z score transformation, or Z-standardization normalizes
the data by shifting (to mean \(\mu\)) and scaling (to standard deviation \(\sigma\)).
Z-transformation can be done with function <code>ZTransform</code>. It is done per rows (features / taxa),
unlike most other transformations. This is often preceded by log10p or clr transformation.
In other words, single value is standardized with respect of feature's values.$$z = \frac{x - \mu}{\sigma}$$
where \(x\) is a single value, \(\mu\) is the mean of the feature, and
\(\sigma\) is the standard deviation of the feature.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Gloor GB, Macklaim JM, Pawlowsky-Glahn V &amp; Egozcue JJ (2017)
Microbiome Datasets Are Compositional: And This Is Not Optional.
Frontiers in Microbiology 8: 2224. doi: 10.3389/fmicb.2017.02224</p>
<p>Legendre P &amp; Gallagher ED (2001)
Ecologically meaningful transformations for ordination of species data.
Oecologia 129: 271-280.</p>
<p>Martino C, Morton JT, Marotz CA, Thompson LR, Tripathi A, Knight R &amp; Zengler K
(2019) A Novel Sparse Compositional Technique Reveals Microbial Perturbations.
mSystems 4: 1. doi: 10.1128/mSystems.00016-19</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Leo Lahti and Tuomas Borman. Contact: <a href="microbiome.github.io">microbiome.github.io</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">esophagus</span><span class="op">)</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">esophagus</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># By specifying 'method', it is possible to apply different transformations, </span></span>
<span class="r-in"><span class="co"># e.g. compositional transformation.</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformSamples</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"relabundance"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># The target of transformation can be specified with "assay_name"</span></span>
<span class="r-in"><span class="co"># Pseudocount can be added by specifying 'pseudocount'.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get pseudocount; here smallest positive value</span></span>
<span class="r-in"><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"relabundance"</span><span class="op">)</span> </span>
<span class="r-in"><span class="va">pseudonumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mat</span><span class="op">[</span><span class="va">mat</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Perform CLR</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformSamples</span><span class="op">(</span><span class="va">x</span>, assay_name <span class="op">=</span> <span class="st">"relabundance"</span>, method <span class="op">=</span> <span class="st">"clr"</span>, </span>
<span class="r-in">                      pseudocount <span class="op">=</span> <span class="va">pseudonumber</span></span>
<span class="r-in">                      <span class="op">)</span></span>
<span class="r-in">                      </span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"clr"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  B          C           D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22  3.4161459  2.0677373  1.10139252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 -0.7397308  0.1706173 -0.81874812</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12  0.5165446  1.7110624 -0.81874812</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 -0.7397308  0.1706173 -0.04661252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  -0.7397308 -0.9279950 -0.04661252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 -0.7397308 -0.9279950 -0.04661252</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Name of the stored table can be specified.</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformSamples</span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">"hellinger"</span>, name<span class="op">=</span><span class="st">"test"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  B          C          D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 0.49629167 0.27296484 0.15109947</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 0.00000000 0.08856149 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 0.09925833 0.22578838 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 0.00000000 0.08856149 0.06757374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  0.00000000 0.00000000 0.06757374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 0.00000000 0.00000000 0.06757374</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># pa returns presence absence table. With 'threshold', it is possible to set the</span></span>
<span class="r-in"><span class="co"># threshold to a desired level. By default, it is 0.</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformSamples</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"pa"</span>, threshold <span class="op">=</span> <span class="fl">35</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"pa"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         B C D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 1 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  0 0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 0 0 0</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># rank returns ranks of taxa. It is calculated column-wise, i.e., per sample</span></span>
<span class="r-in"><span class="co"># and using the ties.method="first" from the colRanks function</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformSamples</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"rank"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"rank"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          B  C  D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 57 55 53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13  1 35  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 44 53  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22  2 36 21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1   3  1 22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10  4  2 23</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># transformCounts is an alias for transformSamples</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformCounts</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"relabundance"</span>, name <span class="op">=</span> <span class="st">"test2"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"test2"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   B           C          D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 0.246305419 0.074509804 0.02283105</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 0.000000000 0.007843137 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 0.009852217 0.050980392 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 0.000000000 0.007843137 0.00456621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  0.000000000 0.000000000 0.00456621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 0.000000000 0.000000000 0.00456621</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In order to use other ranking variants, modify the chosen assay directly:</span></span>
<span class="r-in"><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"rank_average"</span>, withDimnames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">colRanks</span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"counts"</span><span class="op">)</span>, </span>
<span class="r-in">                                                           ties.method<span class="op">=</span><span class="st">"average"</span>, </span>
<span class="r-in">                                                           preserveShape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span>
<span class="r-in">                                                           </span>
<span class="r-in"><span class="co"># If you want to do the transformation for features, you can do that by using</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">transformFeatures</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"log10"</span>, name <span class="op">=</span> <span class="st">"log10_features"</span>, pseudocount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"log10_features"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 B         C         D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 1.7075702 1.3010300 0.7781513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 0.0000000 0.4771213 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 0.4771213 1.1461280 0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 0.0000000 0.4771213 0.3010300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  0.0000000 0.0000000 0.3010300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 0.0000000 0.0000000 0.3010300</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Z-transform can be done for features by using shortcut function</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">ZTransform</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  B          C          D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22  1.1000638 -0.2460669 -0.8539969</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 -0.5773503  1.1547005 -0.5773503</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 -0.4285714  1.1428571 -0.7142857</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 -1.0000000  1.0000000  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  -0.5773503 -0.5773503  1.1547005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 -0.5773503 -0.5773503  1.1547005</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># For visualization purposes it is sometimes done by applying CLR for samples,</span></span>
<span class="r-in"><span class="co"># followed by Z transform for taxa</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">ZTransform</span><span class="op">(</span><span class="fu">transformCounts</span><span class="op">(</span><span class="va">x</span>, method<span class="op">=</span><span class="st">"clr"</span>, assay_name <span class="op">=</span> <span class="st">"counts"</span>, pseudocount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>All the total abundances of samples do not sum-up to a fixed constant. Please consider to apply, e.g., relative transformation in prior to CLR transformation.</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Relative abundances can be also calculated with the dedicated</span></span>
<span class="r-in"><span class="co"># relAbundanceCounts function.</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">relAbundanceCounts</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">x</span>, <span class="st">"relabundance"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   B           C          D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_22 0.246305419 0.074509804 0.02283105</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_5_13 0.000000000 0.007843137 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59_8_12 0.009852217 0.050980392 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_3_22 0.000000000 0.007843137 0.00456621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_5_1  0.000000000 0.000000000 0.00456621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65_1_10 0.000000000 0.000000000 0.00456621</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Felix G.M. Ernst, Sudarshan A. Shetty, Tuomas Borman, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

